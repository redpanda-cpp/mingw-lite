diff --git a/mingw-w64-crt/crt/crtexe.c b/mingw-w64-crt/crt/crtexe.c
index e4a180a3a..ead505cd3 100644
--- a/mingw-w64-crt/crt/crtexe.c
+++ b/mingw-w64-crt/crt/crtexe.c
@@ -343,3 +343,41 @@ int __cdecl atexit (_PVFV func)
 }
 
 char __mingw_module_is_dll = 0;
+
+#include <fcntl.h>
+#include <io.h>
+#include <stdio.h>
+#include <winnls.h>
+
+UINT __mingw_lite_saved_console_cp = 0;
+UINT __mingw_lite_saved_console_output_cp = 0;
+
+static void __cdecl mingw_lite_restore_console_cp(void)
+{
+  if (__mingw_lite_saved_console_cp)
+    SetConsoleCP(__mingw_lite_saved_console_cp);
+  if (__mingw_lite_saved_console_output_cp)
+    SetConsoleOutputCP(__mingw_lite_saved_console_output_cp);
+}
+
+static void __cdecl mingw_lite_console_hack(void)
+{
+  UINT acp = GetACP();
+  UINT console_cp = GetConsoleCP();
+  UINT console_output_cp = GetConsoleOutputCP();
+  if (acp != console_cp) {
+    __mingw_lite_saved_console_cp = console_cp;
+    SetConsoleCP(acp);
+  }
+  if (acp != console_output_cp) {
+    __mingw_lite_saved_console_output_cp = console_output_cp;
+    SetConsoleOutputCP(acp);
+  }
+  atexit(mingw_lite_restore_console_cp);
+
+  _setmode(_fileno(stdin), _O_BINARY);
+  _setmode(_fileno(stdout), _O_BINARY);
+  _setmode(_fileno(stderr), _O_BINARY);
+}
+
+_CRTALLOC(".CRT$XCML") _PVFV __mingw_lite_console_hack = mingw_lite_console_hack;
